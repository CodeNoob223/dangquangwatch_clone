Mỗi khi có một sản phẩm bất kỳ được insert thì sẽ tăng số lượng của sản phẩm đó và tăng cột chiphi + (giá sản phẩm vừa thêm / 2 và làm tròn thành số nguyên dương)
đồng thời tăng cột của sản phẩm tương ứng trong bảng thongke, ví dụ dongho được insert thì tăng thongke.dongho lên 1 đơn vị (với mathongke = 1)

DELIMITER //

CREATE PROCEDURE UpdateThongKeOnInsert(
    IN p_giatien INT,
    IN p_column_name VARCHAR(255)
)
BEGIN
    -- Tăng cột chiphi với giá sản phẩm vừa thêm / 2 và làm tròn thành số nguyên dương
    SET @sql = CONCAT('UPDATE thongke SET chiphi = chiphi + CEIL(? / 2), ', p_column_name, ' = ', p_column_name, ' + 1 WHERE mathongke = 1');
    
    -- Chuẩn bị và thực thi câu lệnh SQL động
    PREPARE stmt FROM @sql;
    EXECUTE stmt USING p_giatien;
    DEALLOCATE PREPARE stmt;
END //

DELIMITER ;

DELIMITER //
CREATE TRIGGER dongho_after_insert
AFTER INSERT ON dongho
FOR EACH ROW
BEGIN
    -- Gọi stored procedure để cập nhật bảng thongke
    CALL UpdateThongKeOnInsert(NEW.giatien, 'dongho');
END // DELIMITER ;

DELIMITER //
CREATE TRIGGER kinhmat_after_insert
AFTER INSERT ON kinhmat
FOR EACH ROW
BEGIN
    -- Gọi stored procedure để cập nhật bảng thongke
    CALL UpdateThongKeOnInsert(NEW.giatien, 'kinhmat');
END //
DELIMITER ;

DELIMITER //
CREATE TRIGGER phukien_after_insert
AFTER INSERT ON phukien
FOR EACH ROW
BEGIN
    -- Gọi stored procedure để cập nhật bảng thongke
    CALL UpdateThongKeOnInsert(NEW.giatien, 'phukien');
END //
DELIMITER ;

DELIMITER //
CREATE TRIGGER trangsuc_after_insert
AFTER INSERT ON trangsuc
FOR EACH ROW
BEGIN
    -- Gọi stored procedure để cập nhật bảng thongke
    CALL UpdateThongKeOnInsert(NEW.gia, 'trangsuc');
END //
DELIMITER ;

DELIMITER //
CREATE TRIGGER butky_after_insert
AFTER INSERT ON butky
FOR EACH ROW
BEGIN
    -- Gọi stored procedure để cập nhật bảng thongke
    CALL UpdateThongKeOnInsert(NEW.giatien, 'butky');
END //
DELIMITER ;


Mỗi lần chitietdonhang được insert thì tăng thongke.luotthemgiohang lên 1 đơn vị (mathongke luôn bằng 1)

DELIMITER //

CREATE TRIGGER chitietdonhang_after_insert
AFTER INSERT ON chitietdonhang
FOR EACH ROW
BEGIN
    -- Tăng cột luotthemgiohang trong bảng thongke
    UPDATE thongke
    SET luotthemgiohang = luotthemgiohang + 1,
        luottruycap = luottruycap + 1,
        luotxemsanpham = luotxemsanpham + 1
    WHERE mathongke = 1;
END //

DELIMITER ;


Mỗi khi có donhang được insert với tinhtrang là 'Chờ xác nhận' thì tăng thongke donhangchoxacnhan luotdathang
Đồng thời tăng thongke.donhang
DELIMITER //

CREATE TRIGGER donhang_after_insert
AFTER INSERT ON donhang
FOR EACH ROW
BEGIN
    -- Tăng giá trị của cột donhang trong bảng thongke
    UPDATE thongke
    SET donhang = donhang + 1, luotdathang = luotdathang + 1
    WHERE mathongke = 1;

    -- Kiểm tra nếu tinhtrang là 'Chờ xác nhận'
    IF NEW.tinhtrang = 'Chờ xác nhận' THEN
        -- Tăng cột donhangchoxacnhan trong bảng thongke
        UPDATE thongke
        SET donhangchoxacnhan = donhangchoxacnhan + 1
        WHERE mathongke = 1;
    END IF;
END //

DELIMITER ;


Mỗi khi có donhang được cập nhật tình trạng từ 'Chờ xác nhận' thành 'Đã xác nhận' thì giảm donhangchoxacnhan 1 đơn vị
DELIMITER //

CREATE TRIGGER donhang_after_xacnhan
AFTER UPDATE ON donhang
FOR EACH ROW
BEGIN
    -- Kiểm tra nếu tình trạng thay đổi từ 'Chờ xác nhận' thành 'Đã xác nhận'
    IF OLD.tinhtrang = 'Chờ xác nhận' AND NEW.tinhtrang = 'Đã xác nhận' THEN
        -- Giảm giá trị của cột donhangchoxacnhan trong bảng thongke
        UPDATE thongke
        SET donhangchoxacnhan = donhangchoxacnhan - 1
        WHERE mathongke = 1;
    END IF;
END //

DELIMITER ;


Tăng giá trị của donhangdanggiao khi tình trạng đơn hàng được cập nhật từ 'Đã xác nhận' thành 'Đang vận chuyển'.
DELIMITER //

CREATE TRIGGER donghang_after_giao
AFTER UPDATE ON donhang
FOR EACH ROW
BEGIN
    -- Kiểm tra nếu tình trạng thay đổi từ 'Đã xác nhận' thành 'Đang vận chuyển'
    IF OLD.tinhtrang = 'Đã xác nhận' AND NEW.tinhtrang = 'Đang vận chuyển' THEN
        -- Tăng giá trị của cột donhangdanggiao trong bảng thongke
        UPDATE thongke
        SET donhangdanggiao = donhangdanggiao + 1
        WHERE mathongke = 1;
    END IF;
END //

DELIMITER ;


Tăng giá trị của donhangdagiao, luotthanhtoan, chiphi và doanhthu khi tình trạng đơn hàng được cập nhật từ 'Đang vận chuyển' thành 'Đã nhận hàng', đồng thời giảm donhangdanggiao.
DELIMITER //

CREATE TRIGGER donhang_after_nhan
AFTER UPDATE ON donhang
FOR EACH ROW
BEGIN
    -- Kiểm tra nếu tình trạng thay đổi từ 'Đang vận chuyển' thành 'Đã nhận hàng'
    IF OLD.tinhtrang = 'Đang vận chuyển' AND NEW.tinhtrang = 'Đã nhận hàng' THEN
        -- Tăng giá trị của các cột donhangdagiao, luotthanhtoan, chiphi và doanhthu trong bảng thongke
        UPDATE thongke
        SET donhangdagiao = donhangdagiao + 1,
            luotthanhtoan = luotthanhtoan + 1,
            chiphi = chiphi + 50000,
            doanhthu = doanhthu + NEW.tongtien,
            donhangdanggiao = donhangdanggiao - 1
        WHERE mathongke = 1;
    END IF;
END //

DELIMITER ;


Tăng giá trị của donhangdahuy và giảm giá trị của các cột tương ứng (donhangchoxacnhan, donhangdanggiao) dựa vào tình trạng cũ khi tình trạng đơn hàng được cập nhật thành 'Đã hủy'.
DELIMITER //

CREATE TRIGGER donhang_after_huy
AFTER UPDATE ON donhang
FOR EACH ROW
BEGIN
    -- Kiểm tra nếu tình trạng mới là 'Đã hủy'
    IF NEW.tinhtrang = 'Đã hủy' THEN
        -- Tăng giá trị của cột donhangdahuy trong bảng thongke
        UPDATE thongke
        SET donhangdahuy = donhangdahuy + 1, donhang = donhang - 1
        WHERE mathongke = 1;

        -- Giảm giá trị của các cột tương ứng dựa vào tình trạng cũ
        IF OLD.tinhtrang = 'Chờ xác nhận' THEN
            UPDATE thongke
            SET donhangchoxacnhan = donhangchoxacnhan - 1
            WHERE mathongke = 1;
        ELSEIF OLD.tinhtrang = 'Đang vận chuyển' THEN
            UPDATE thongke
            SET donhangdanggiao = donhangdanggiao - 1
            WHERE mathongke = 1;
        END IF;
    END IF;
END //

DELIMITER ;



Để thực hiện yêu cầu này, bạn cần tạo một trigger trên bảng taikhoan để lắng nghe sự kiện INSERT. Khi một tài khoản mới được thêm vào với loai_tai_khoan là 'ROLE_KHACHHANG', trigger này sẽ tăng giá trị của các cột khachhang và luotdangkymoi trong bảng thongke.
DELIMITER //

CREATE TRIGGER taikhoan_after_insert_khachhang
AFTER INSERT ON taikhoan
FOR EACH ROW
BEGIN
    -- Kiểm tra nếu loai_tai_khoan là 'ROLE_KHACHHANG'
    IF NEW.loai_tai_khoan = 'ROLE_KHACHHANG' THEN
        -- Tăng giá trị của các cột khachhang và luotdangkymoi trong bảng thongke
        UPDATE thongke
        SET khachhang = khachhang + 1,
            luotdangkymoi = luotdangkymoi + 1
        WHERE mathongke = 1;
    END IF;
END //

DELIMITER ;
